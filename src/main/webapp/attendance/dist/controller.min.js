app.controller("indexController",["$scope","$rootScope","$http","localStorageService","$interval","SweetAlert",function(e,t,o,a,r,n){t.userInfo=t.userInfo||a.get("userInfo"),t.userInfo||e.userLogout(),t.schoolInfo=t.schoolInfo||a.get("schoolInfo")||{},t.sign=t.userInfo.sign,e.userLogout=function(){a.clearAll(),window.location.href="/#login"}}]),app.controller("formPageController",["$scope","$rootScope","$http","httpService","localStorageService","$interval","SweetAlert","$window","baseService",function(e,t,o,a,r,n,i,l,s){}]),app.controller("courseArrangeFormController",["$scope","$rootScope","$uibModalInstance","params","$http","httpService","localStorageService","$interval","SweetAlert",function(o,e,t,a,r,n,i,l,s){o.title=a?"编辑课程安排":"新增课程安排",o.formData=a||[],o.startWeekOptions=new Array(25),o.weekOptions=new Array(7),o.classOptions=new Array(12),o.weekAndClassIndex=new Array(1),o.startYearOptions=new Array(5),o.currentYear=(new Date).getFullYear();try{o.weekAndClassIndex=new Array(o.formData.week.length)}catch(e){}var c;o.formData.week||(o.formData.week=[],o.formData.classIndex=[]),a={params:{schoolId:e.schoolInfo.id}},r.get("/courseMenage/getAll",a).success(function(e){e?o.courseData=e.data:s.info("没有课程信息")}).error(function(e){s.error("没有课程信息","请检查网络...")}),o.searchTeacher=function(e){var t={courseId:e};n.getAll("userManage/getAll",t).then(function(e){e?o.teacherOptions=e.data:s.info("没有用户信息")},function(e){s.error("没有用户信息","请检查网络...")})},o.formData.courseId&&o.searchTeacher(o.formData.courseId),n.getAll("classManage/getAllToTree").then(function(e){e?o.buildOptions=e:s.info("没有教室信息")},function(e){s.error("没有教室信息","请检查网络...")}),o.close=function(e){t.close(e)},o.dismiss=function(e){t.dismiss(e)},o.isShowClassIndex=!1,o.showClassIndex=function(e){o.isShowClassIndex=!0,c=e,o.formData.classIndex[c]&&(o.classIndex=o.formData.classIndex[c])},o.changeClassIndex=function(){o.isShowClassIndex=!1,o.formData.classIndex[c]=[],$.extend(!0,o.formData.classIndex[c],o.classIndex),o.classIndex=[],c=void 0},o.saveData=function(){n.addRow("courseMenage/addCourseArrage",{params:JSON.stringify(o.formData)}).then(function(e){0<e?(s.success("操作成功"),o.close(e)):s.error("操作失败")},function(e){s.error("操作失败","系统维护中")})}}]),app.controller("courseArrangeController",["$scope","$rootScope","$state","$stateParams","$uibModal","$http","httpService","localStorageService","SweetAlert",function(a,e,t,o,r,n,i,l,s){function c(e){e=e||{};try{e.schoolId=a.schoolInfo.id,e.schoolName=a.schoolInfo.name}catch(e){}r.open({backdrop:"static",keyboard:!1,animation:!0,templateUrl:"arrangeForm.html",controller:"courseArrangeFormController",resolve:{params:e},size:"md"}).result.then(function(e){a.queryList()},function(e){})}e.menuList=[{title:"课程安排"}],a.bodyTitle=e.menuList[e.menuList.length-1].title,a.pagination={totalCount:0,currentPage:1,totalPage:1,pageSize:0,pageSizeList:[10,20,30]},a.pagination.pageSize=a.pagination.pageSizeList[0],a.pageFields={list:[{title:"学年学期",type:"yearTerm",order:"asc"},{title:"课程编号",type:"courseCode",order:"desc"},{title:"课程名称",type:"courseName",order:"desc"},{title:"任课教师",type:"teacherName",order:"desc"},{title:"上课时间地点",type:"whenWhere",order:"desc"}],order:"yearTerm",__order:!1},a.searchOptions={"":"请选择搜索条件",courseName:"课程名称",courseCode:"课程编号",teacherName:"任课教师"},a.searchValue={key:"",value:""},a.tableData=[],0<e.sign&&!a.schoolInfo||(a.setOrder=function(e){a.pageFields.order==a.pageFields.list[e].type?(a.pageFields.__order=!a.pageFields.__order,a.pageFields.__order?a.pageFields.list[e].order="asc":a.pageFields.list[e].order="desc"):a.pageFields.order=a.pageFields.list[e].type},a.searchInit=function(){a.searchValue.value="",a.queryList()},a.queryList=function(){var e={pageSize:a.pagination.pageSize,pageNo:a.pagination.currentPage,order:a.pageFields.order,__order:a.pageFields.__order?0:1};e[a.searchValue.key]=a.searchValue.value,i.getAll("courseMenage/getAllCourseArrage",e).then(function(e){e?(a.tableData=e.data,a.pagination.pageSize=e.pageSize,a.pagination.currentPage=e.pageNo,a.pagination.totalCount=e.totalCount,a.pagination.totalPage=e.totalPage):s.info("没有课程信息安排")},function(e){s.error("没有课程信息安排","请检查网络...")})},a.queryList(),a.addData=function(){c()},a.editData=function(e){c(e)},a.delData=function(e){var o=[];if(e||0==e)o.push(e);else if(a.select_all)for(var t in a.tableData)o.push(a.tableData[t].id);else for(var t in a.tableData)a.tableData[t].checked&&o.push(a.tableData[t].id);0!=o.length?s.swal({title:"确认删除所选择的课程全部信息",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"确定",type:"info"},function(e){var t;e&&(t=o,i.delRow("courseMenage/delRow",{ids:JSON.stringify(t)}).then(function(e){0==e?s.error("删除失败"):(1<e&&s.swal({title:"已删除"+e+"所课程的信息",type:"info",timer:"3000"}),a.queryList())},function(){s.error("删除失败","请检查网络...")}))}):s.info("至少选择一项")},a.editCourseData=function(e){l.set("courseData_courseSetting",e),t.go("coursePage")})}]),app.controller("courseFormController",["$scope","$rootScope","$uibModalInstance","params","$http","httpService","localStorageService","$interval","SweetAlert",function(n,e,t,o,a,r,i,l,s){n.title=o?"编辑课程信息":"新增课程信息",n.formData=o||[],n.schoolName=n.formData.schoolName,n.parentName=n.formData.parentName||n.formData.collegeName,n.collegeName=n.formData.collegeName,a.get("/collegeManage/getSchoolAndCollege",{params:e.schoolInfo}).success(function(e){if("array"==$.type(e)){1==(n.schoolAndCollege=e).length&&(n.school_index=0);try{n.nameChange(n.schoolName,e,"school"),n.nameChange(n.parentName,e[n.school_index].data,"parent"),n.nameChange(n.collegeName,e[n.school_index].data[n.parent_index].children,"college")}catch(e){}}else s.error("数据加载失败","系统维护中...")}).error(function(e){s.error("数据加载失败","系统维护中...")}),n.nameChange=function(a,e,r){try{angular.forEach(e,function(e,t){var o="name";if("school"==r&&(o="schoolName"),e[o]==a)throw n[r+"_index"]=t,""}),n[r+"_index"]=-1}catch(e){}},n.close=function(e){t.close(e)},n.dismiss=function(e){t.dismiss(e)},n.saveData=function(){n.formData.collegeId=null;try{n.formData.collegeId=n.schoolAndCollege[n.school_index].data[n.parent_index].id,n.formData.collegeId=n.schoolAndCollege[n.school_index].data[n.parent_index].children[n.college_index].id}catch(e){if(!n.formData.collegeId)return void s.error("填写正确的院系")}r.addRow("courseMenage/addCourse",{params:JSON.stringify(n.formData)}).then(function(e){0<e?(s.success("操作成功"),n.close(e)):s.error("操作失败")},function(e){s.error("操作失败","系统维护中")})}}]),app.controller("courseListController",["$scope","$rootScope","$state","$stateParams","$uibModal","$http","httpService","localStorageService","SweetAlert",function(a,e,t,o,r,n,i,l,s){if(0<e.sign);else switch(o.showAll){case 0:a.schoolInfo=l.get("schoolData_courseSetting");break;case 1:l.remove("schoolData_courseSetting"),a.schoolInfo=void 0;break;case 2:a.schoolInfo=l.get("schoolData_courseSetting");break;default:a.schoolInfo=void 0}function c(e){e=e||{};try{e.schoolId=a.schoolInfo.id,e.schoolName=a.schoolInfo.name}catch(e){}r.open({backdrop:"static",keyboard:!1,animation:!0,templateUrl:"courseForm.html",controller:"courseFormController",resolve:{params:e},size:"md"}).result.then(function(e){a.queryList()},function(e){})}e.menuList=[{title:"课程列表"}],a.schoolInfo&&0==e.sign&&e.menuList.splice(0,0,{title:"学院列表",href:"#schoolMenage"}),a.bodyTitle=e.menuList[e.menuList.length-1].title,a.pagination={totalCount:0,currentPage:1,totalPage:1,pageSize:0,pageSizeList:[10,20,30]},a.pagination.pageSize=a.pagination.pageSizeList[0],a.pageFields={list:[{title:"课程编号",type:"code",order:"desc"},{title:"课程名称",type:"name",order:"desc"},{title:"学校",type:"schoolName",order:"desc"},{title:"院系",type:"collegeName",order:"desc"},{title:"学时",type:"studyHours",order:"desc"},{title:"学分",type:"credit",order:"desc"}],order:"code",__order:!1},a.searchOptions={"":"请选择搜索条件",name:"课程名称",code:"课程编号",schoolName:"学校",collegeName:"院系",credit:"学分",studyHours:"学时"},a.searchValue={key:"",value:""},a.tableData=[],0<e.sign&&!a.schoolInfo||(a.setOrder=function(e){a.pageFields.order==a.pageFields.list[e].type?(a.pageFields.__order=!a.pageFields.__order,a.pageFields.__order?a.pageFields.list[e].order="asc":a.pageFields.list[e].order="desc"):a.pageFields.order=a.pageFields.list[e].type},a.searchInit=function(){a.searchValue.value="",a.queryList()},a.queryList=function(){var e={pageSize:a.pagination.pageSize,pageNo:a.pagination.currentPage,order:a.pageFields.order,__order:a.pageFields.__order?0:1};e[a.searchValue.key]=a.searchValue.value;try{e.schoolId=a.schoolInfo.id}catch(e){}i.getAll("courseMenage/getAll",e).then(function(e){e?(a.tableData=e.data,a.pagination.pageSize=e.pageSize,a.pagination.currentPage=e.pageNo,a.pagination.totalCount=e.totalCount,a.pagination.totalPage=e.totalPage):s.info("没有课程信息")},function(e){s.error("没有课程信息","请检查网络...")})},a.queryList(),a.addData=function(){c()},a.editData=function(e){c(e)},a.delData=function(e){var o=[];if(e||0==e)o.push(e);else if(a.select_all)for(var t in a.tableData)o.push(a.tableData[t].id);else for(var t in a.tableData)a.tableData[t].checked&&o.push(a.tableData[t].id);0!=o.length?s.swal({title:"确认删除所选择的课程全部信息",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"确定",type:"info"},function(e){var t;e&&(t=o,i.delRow("courseMenage/delRow",{ids:JSON.stringify(t)}).then(function(e){0==e?s.error("删除失败"):(1<e&&s.swal({title:"已删除"+e+"所课程的信息",type:"info",timer:"3000"}),a.queryList())},function(){s.error("删除失败","请检查网络...")}))}):s.info("至少选择一项")},a.editCourseData=function(e){l.set("courseData_courseSetting",e),t.go("coursePage")})}]),app.controller("classDistributionController",["$scope","$rootScope","dis","$uibModalInstance","$http","httpService","localStorageService","$interval","SweetAlert",function(l,e,t,o,a,r,n,i,s){console.log(t),l.close=function(e){o.close(e)},l.dismiss=function(e){o.dismiss(e)},l.lock=t.lock||!1,l.set_row=t.row||5,l.set_col=t.col||5,l.rowArray=new Array(l.set_row),l.colArray=new Array(l.set_col+1),l.changeRow=function(){l.set_row||(l.set_row=5);var e=l.rowArray.length;if(e<l.set_row)for(var t=0;t<l.set_row-e;t++)l.rowArray.push("");else l.rowArray.splice(l.set_row)},l.changeCol=function(){l.set_col||(l.set_col=5);var e=l.colArray.length;if(e<l.set_col+1)for(var t=0;t<l.set_col-e+1;t++)l.colArray.push("");else l.colArray.splice(l.set_col+1)},l.road=t.road||[],l.setRoad=function(e,t,o){if(!l.lock&&o){var a={x:t,y:o},r=-1;for(var n in l.road){var i=l.road[n];if(i.x==t&&i.y==o){r=n;break}}-1!=r?l.road.splice(r,1):l.road.push(a)}},l.setClass=function(e,t){var o=0==t?"distribution-col-title":"distribution-cell",a=-1;for(var r in l.road){var n=l.road[r];if(n.x==e&&n.y==t){a=r;break}}return-1!=a&&(o+=" distribution-cell-road"),o},l.saveData=function(){var e={row:l.set_row,col:l.set_col,road:l.road};l.close(e)}}]),app.controller("classFormController",["$scope","$rootScope","$uibModal","$uibModalInstance","params","$http","httpService","localStorageService","$interval","SweetAlert",function(t,e,o,a,r,n,i,l,s,c){t.title=r?"编辑教室信息":"新增教室信息",t.formData=r,t.formData&&t.formData.schoolId||(t.showSchool=!0,i.getAll("schoolMenage/getAll").then(function(e){e?t.schoolData=e.data:(c.info("没有学校信息"),t.dismiss())},function(e){c.error("没有学校信息","请检查网络..."),t.dismiss()})),t.close=function(e){a.close(e)},t.dismiss=function(e){a.dismiss(e)},t.saveData=function(){t.formData.row&&t.formData.col?i.addRow("classManage/addClass",{params:JSON.stringify(t.formData)}).then(function(e){0<e?(c.success("操作成功"),t.close(e)):c.error("操作失败")},function(e){c.error("操作失败","系统维护中")}):c.error("请设置教室分布","")},t.openSetDist=function(){o.open({backdrop:"static",keyboard:!1,animation:!0,templateUrl:"classDistribution.html",controller:"classDistributionController",size:"xlg",resolve:{dis:{row:t.formData.row,col:t.formData.col,road:t.formData.road}}}).result.then(function(e){t.formData.row=e.row,t.formData.col=e.col,t.formData.road=e.road},function(e){})}}]),app.controller("classListController",["$scope","$rootScope","$state","$stateParams","$uibModal","$http","httpService","localStorageService","SweetAlert",function(a,e,t,o,r,n,i,l,s){if(0<e.sign);else switch(o.showAll){case 0:a.schoolInfo=l.get("schoolData_classSetting");break;case 1:l.remove("schoolData_classSetting"),a.schoolInfo=void 0;break;case 2:a.schoolInfo=l.get("schoolData_classSetting");break;default:a.schoolInfo=void 0}function c(e){e=e||{};try{e.schoolId=a.schoolInfo.id,e.schoolName=a.schoolInfo.name}catch(e){}r.open({backdrop:"static",keyboard:!1,animation:!0,templateUrl:"classForm.html",controller:"classFormController",resolve:{params:e},size:"md"}).result.then(function(e){a.queryList()},function(e){})}e.menuList=[{title:"教室列表"}],a.bodyTitle=e.menuList[e.menuList.length-1].title,a.pagination={totalCount:0,currentPage:1,totalPage:1,pageSize:0,pageSizeList:[10,20,30]},a.pagination.pageSize=a.pagination.pageSizeList[0],a.pageFields={list:[{title:"教学楼",type:"buildName"},{title:"教室",type:"className"},{title:"分布",type:"info"}]},a.tableData=[],0<e.sign&&!a.schoolInfo||(a.searchInit=function(){a.searchValue="",a.queryList()},a.queryList=function(){var e={pageSize:a.pagination.pageSize,pageNo:a.pagination.currentPage,searchValue:a.searchValue};i.getAll("classManage/getAll",e).then(function(e){e?(a.tableData=e.data,angular.forEach(a.tableData,function(e){e.road=JSON.parse(e.road)}),a.pagination.pageSize=e.pageSize,a.pagination.currentPage=e.pageNo,a.pagination.totalCount=e.totalCount,a.pagination.totalPage=e.totalPage):s.info("没有教室信息")},function(e){s.error("没有教室信息","请检查网络...")})},a.queryList(),a.addData=function(){c()},a.editData=function(e,t){c(e)},a.showDis=function(e){r.open({backdrop:"static",keyboard:!1,animation:!0,templateUrl:"classDistribution.html",controller:"classDistributionController",size:"xlg",resolve:{dis:{row:e.row,col:e.col,road:e.road,lock:!0}}})},a.delData=function(e){var o=[];if(e||0==e)o.push(e);else if(a.select_all)for(var t in a.tableData)o.push(a.tableData[t].id);else for(var t in a.tableData)a.tableData[t].checked&&o.push(a.tableData[t].id);0!=o.length?s.swal({title:"确认删除所选择的教室全部信息",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"确定",type:"info"},function(e){var t;e&&(t=o,i.delRow("classManage/delRow",{ids:JSON.stringify(t)}).then(function(e){0==e?s.error("删除失败"):(1<e&&s.swal({title:"已删除"+e+"所教室的信息",type:"info",timer:"3000"}),a.queryList())},function(){s.error("删除失败","请检查网络...")}))}):s.info("至少选择一项")})}]),app.controller("collegeFormController",["$scope","$rootScope","$uibModalInstance","params","$http","httpService","localStorageService","$interval","SweetAlert",function(t,e,o,a,r,n,i,l,s){a.isChild?t.title="系":t.title="学院",a.isAdd?t.title="新增"+t.title+"信息":t.title="编辑"+t.title+"信息",(t.formData=a).isAdd&&n.getAll("schoolMenage/getAll").then(function(e){e?t.schoolData=e.data:(s.info("没有学校信息"),t.dismiss())},function(e){s.error("没有学校信息","请检查网络..."),t.dismiss()}),t.close=function(e){o.close(e)},t.dismiss=function(e){o.dismiss(e)},t.saveData=function(){try{t.formData.parent.id||delete t.formData.parent}catch(e){delete t.formData.parent}n.addRow("collegeManage/addCollege",{params:JSON.stringify(t.formData)}).then(function(e){0<e?(s.success("操作成功"),t.close(e)):s.error("操作失败")},function(e){s.error("操作失败","系统维护中")})}}]),app.controller("collegeListController",["$scope","$rootScope","$state","$stateParams","$uibModal","$http","httpService","localStorageService","SweetAlert",function(a,e,t,o,r,n,i,l,s){if(0<e.sign);else switch(o.showAll){case 0:a.schoolInfo=l.get("schoolData_collegeSetting");break;case 1:l.remove("schoolData_collegeSetting"),a.schoolInfo=void 0;break;case 2:a.schoolInfo=l.get("schoolData_collegeSetting");break;default:a.schoolInfo=void 0}function c(e,t){e=e||{};try{e.schoolId=t.schoolId||a.schoolInfo.id,e.schoolName=t.schoolName||a.schoolInfo.name}catch(e){}e.parent=t,r.open({backdrop:"static",keyboard:!1,animation:!0,templateUrl:"collegeForm.html",controller:"collegeFormController",resolve:{params:e},size:"md"}).result.then(function(e){a.queryList()},function(e){})}e.menuList=[{title:"院系列表"}],a.bodyTitle=e.menuList[e.menuList.length-1].title,a.pagination={totalCount:0,currentPage:1,totalPage:1,pageSize:0,pageSizeList:[10,20,30]},a.pagination.pageSize=a.pagination.pageSizeList[0],a.pageFields={list:[{title:"学院编号",type:"code",order:"desc"},{title:"学院名称",type:"name",order:"desc"},{title:"其它学院信息",type:"info"}],order:"code",__order:!1},a.searchOptions={"":"请选择搜索条件",name:"学院名称",code:"学院编号"},a.searchValue={key:"",value:""},a.tableData=[],0<e.sign&&!a.schoolInfo||(a.setOrder=function(e){a.pageFields.order==a.pageFields.list[e].type?(a.pageFields.__order=!a.pageFields.__order,a.pageFields.__order?a.pageFields.list[e].order="asc":a.pageFields.list[e].order="desc"):a.pageFields.order=a.pageFields.list[e].type,a.queryList()},a.searchInit=function(){a.searchValue.value="",a.queryList()},a.queryList=function(){var e={pageSize:a.pagination.pageSize,pageNo:a.pagination.currentPage,order:a.pageFields.order,__order:a.pageFields.__order?0:1};e[a.searchValue.key]=a.searchValue.value;try{e.schoolId=a.schoolInfo.id}catch(e){}i.getAll("collegeManage/getAll",e).then(function(e){e?(a.tableData=e.data,a.pagination.pageSize=e.pageSize,a.pagination.currentPage=e.pageNo,a.pagination.totalCount=e.totalCount,a.pagination.totalPage=e.totalPage):s.info("没有学院信息")},function(e){s.error("没有学院信息","请检查网络...")})},a.queryList(),a.addData=function(e){var t={isAdd:!0};e&&(t.isChild=!0),c(t,e)},a.editData=function(e,t){var o={};$.extend(!0,o,e),t&&(o.isChild=!0),c(o,t)},a.delData=function(e){var o=[];if(e||0==e)o.push(e);else if(a.select_all)for(var t in a.tableData)o.push(a.tableData[t].id);else for(var t in a.tableData)a.tableData[t].checked&&o.push(a.tableData[t].id);0!=o.length?s.swal({title:"确认删除所选择的全部信息",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"确定",type:"info"},function(e){var t;e&&(t=o,i.delRow("collegeManage/delRow",{ids:JSON.stringify(t)}).then(function(e){0==e?s.error("删除失败"):(1<e&&s.swal({title:"已删除"+e+"项信息",type:"info",timer:"3000"}),a.queryList())},function(){s.error("删除失败","请检查网络...")}))}):s.info("至少选择一项")})}]),app.controller("schoolFormController",["$scope","$rootScope","$uibModalInstance","params","$http","httpService","localStorageService","$interval","SweetAlert",function(t,e,o,a,r,n,i,l,s){t.title=a?"编辑学校信息":"新增学校信息",t.formData=a||{},t.close=function(e){o.close(e)},t.dismiss=function(e){o.dismiss(e)},t.saveData=function(){n.addRow("schoolMenage/addSchool",t.formData).then(function(e){0<e?(s.success("操作成功"),t.close(e)):s.error("操作失败")},function(e){s.error("操作失败","系统维护中")})}}]),app.controller("schoolListController",["$scope","$rootScope","$state","$uibModal","$http","httpService","localStorageService","SweetAlert",function(a,e,t,o,r,n,i,l){function s(e){o.open({backdrop:"static",keyboard:!1,animation:!0,templateUrl:"schoolForm.html",controller:"schoolFormController",resolve:{params:e},size:"md"}).result.then(function(e){a.queryList()},function(e){})}e.menuList=[{title:"学校列表"}],a.bodyTitle=e.menuList[e.menuList.length-1].title,a.pagination={totalCount:0,currentPage:1,totalPage:1,pageSize:0,pageSizeList:[10,20,30]},a.pagination.pageSize=a.pagination.pageSizeList[0],a.pageFields={list:[{title:"学校名称",type:"name",order:"desc"},{title:"学校编号",type:"code",order:"desc"},{title:"学校详情",type:"info"}],order:"code",__order:!1},a.setOrder=function(e){a.pageFields.order==a.pageFields.list[e].type?(a.pageFields.__order=!a.pageFields.__order,a.pageFields.__order?a.pageFields.list[e].order="asc":a.pageFields.list[e].order="desc"):a.pageFields.order=a.pageFields.list[e].type,a.queryList()},a.searchOptions={"":"请选择搜索条件",name:"学校名称",code:"学校编号"},a.searchValue={key:"",value:""},a.searchInit=function(){a.searchValue.value="",a.queryList()},a.tableData=[],a.queryList=function(){var e={pageSize:a.pagination.pageSize,pageNo:a.pagination.currentPage,order:a.pageFields.order,__order:a.pageFields.__order?0:1};e[a.searchValue.key]=a.searchValue.value,n.getAll("schoolMenage/getAll",e).then(function(e){e?(a.tableData=e.data,a.pagination.pageSize=e.pageSize,a.pagination.currentPage=e.pageNo,a.pagination.totalCount=e.totalCount,a.pagination.totalPage=e.totalPage):l.info("没有学校信息")},function(e){l.error("没有学校信息","请检查网络...")})},a.queryList(),a.addData=function(){s()},a.editData=function(e){s(e)},a.delData=function(e){var o=[];if(e||0==e)o.push(e);else if(a.select_all)for(var t in a.tableData)o.push(a.tableData[t].id);else for(var t in a.tableData)a.tableData[t].checked&&o.push(a.tableData[t].id);0!=o.length?l.swal({title:"确认删除所选择的学校全部信息",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"确定",type:"info"},function(e){var t;e&&(t=o,n.delRow("schoolMenage/delRow",{ids:JSON.stringify(t)}).then(function(e){0==e?l.error("删除失败"):(1<e&&l.swal({title:"已删除"+e+"所学校的信息",type:"info",timer:"3000"}),a.queryList())},function(){l.error("删除失败","请检查网络...")}))}):l.info("至少选择一项")},a.editCollegeData=function(e){i.set("schoolData_collegeSetting",e),t.go("collegeManage",{showAll:2})},a.goCollegeMenage=function(){t.go("collegeManage",{showAll:0})}}]),app.controller("absenceLevelController",["$scope","$rootScope","$state","$stateParams","$uibModal","$http","httpService","localStorageService","SweetAlert","$timeout",function(a,e,t,o,r,n,i,l,s,c){e.menuList=[{title:"缺课等级设置"}],a.bodyTitle=e.menuList[e.menuList.length-1].title,a.levelOptions=[],a.edit=!1,a.$watch("levelOptions",function(e,t,o){e!=t&&0==a.edit&&(a.edit=!0)},!0),a.queryList=function(){i.getAll("studySetting/getAbsenceLevel").then(function(e){e?(a.levelOptions=e,console.log(e)):s.info("未设置缺课等级"),c(function(){a.edit=!1})},function(e){s.error("网络异常","请检查网络...")})},a.queryList(),a.saveData=function(){var e=a.levelOptions;i.addRow("studySetting/saveAbsenceLevel",{params:JSON.stringify(e)}).then(function(e){0<e?a.queryList():s.error("保存失败","请检查网络")},function(){s.error("保存失败","请检查网络")})}}]),app.controller("assessmentWeightController",["$scope","$rootScope","$state","$stateParams","$uibModal","$http","httpService","localStorageService","SweetAlert","$timeout",function(a,e,t,o,r,n,i,l,s,c){e.menuList=[],0==e.sign?e.menuList.push({title:"考核权重模板设置"}):1==e.sign?e.menuList.push({title:"考核权重设置"}):history.back(),a.bodyTitle=e.menuList[e.menuList.length-1].title,a.templateOptions=[],a.edit=!1,a.$watch("templateOptions",function(e,t,o){t!=e&&(a.edit||(a.edit=!0))},!0),a.templateReadOnly=0!=e.sign,a.queryList=function(){i.getAll("studySetting/getTemplateData").then(function(e){a.templateOptions=e||[],c(function(){a.edit=!1})},function(){s.error("数据加载失败","请检查网络")})},a.queryList(),a.saveData=function(){var e=[];for(var t in $.extend(!0,e,a.templateOptions),e)for(var o in delete e[t].$$hashKey,e[t].value)delete e[t].value[o].$$hashKey;i.addRow("studySetting/saveTemplateData",{params:JSON.stringify(e)}).then(function(e){0<e?a.queryList():s.error("保存失败","请检查网络")},function(){s.error("保存失败","请检查网络")})},0!=e.sign&&(a.weightOptions=[],a.weightOptionsEdit={delete:!0},a.weightEdit=!1,a.setWeightOptionsEdit=function(e,t){a.weightOptionsEdit={delete:!1},$.extend(!0,a.weightOptionsEdit,e),t&&delete a.weightOptionsEdit.id},a.pushItem=function(){if(a.weightOptionsEdit.id){for(var e in a.weightOptions)if(a.weightOptions[e].id==a.weightOptionsEdit.id){a.weightOptions[e]=a.weightOptionsEdit;break}}else a.weightOptions.push(a.weightOptionsEdit);a.weightOptionsEdit={delete:!0}},a.$watch("weightOptions",function(e,t,o){t!=e&&(a.weightEdit||(a.weightEdit=!0))},!0),a.weightQueryList=function(){i.getAll("studySetting/getweightData").then(function(e){a.weightOptions=e||[],c(function(){a.weightEdit=!1})},function(){s.error("数据加载失败","请检查网络")})},a.weightQueryList(),a.saveWeightData=function(){var e=[];for(var t in $.extend(!0,e,a.weightOptions),e){for(var o in delete e[t].$$hashKey,e[t].value)delete e[t].value[o].$$hashKey;if(e[t].courseId=a.courseOptions2[e[t].name],!e[t].courseId)return void s.error("课程不存在，请重试")}i.addRow("studySetting/saveWeightData",{params:JSON.stringify(e)}).then(function(e){0<e?a.weightQueryList():s.error("保存失败","请检查网络")},function(){s.error("保存失败","请检查网络")})},a.courseOptions={},a.courseOptions2={},a.courseOptionsQueryList=function(){i.getAll("courseMenage/getAllCourseArrage",{pageSize:0,pageNo:1}).then(function(e){if(e)for(var t in e.data)a.courseOptions[e.data[t].courseId]=e.data[t].courseName,a.courseOptions2[e.data[t].courseName]=e.data[t].courseId},function(e){})},a.courseOptionsQueryList())}]),app.controller("userFormController",["$scope","$rootScope","$uibModal","$uibModalInstance","params","$http","httpService","localStorageService","$interval","SweetAlert",function(n,t,e,o,a,r,i,l,s,c){n.title=a?"编辑用户基本信息":"新增用户基本信息",n.formData=a||{},n.formData.birthday=n.formData.birthday?new Date(n.formData.birthday):new Date,n.formData.sex=n.formData.sex||0,n.formData.birthday.setFullYear(n.formData.birthday.getFullYear()-10),n.birthdayOptions={config:{defaultDate:n.formData.birthday,maxDate:n.formData.birthday,minDate:null,buttonBar:{today:{show:!1},clear:{text:"清除"},close:{text:"关闭"},default:{text:"默认",show:!0}}},openEvent:function(){n.birthdayOptions.open=!0},open:!1},n.close=function(e){o.close(e)},n.dismiss=function(e){o.dismiss(e)},n.saveDataAndContinue=function(){n.saveData()},n.edutitle=a?"编辑用户教育信息":"新增用户教育信息",n.powerOptions=[{sign:0,name:"数据管理员"},{sign:1,name:"校园数据管理员"},{sign:2,name:"教师"},{sign:3,name:"学生"}],n.formData.power=n.formData.power||3,n.schoolAndCollege=[],r.get("/collegeManage/getSchoolAndCollege").success(function(e){if("array"==$.type(e)){n.schoolAndCollege=e;try{n.nameChange(n.schoolName,e,"school"),1==e.length&&(n.school_index=0),n.nameChange(n.parentName,e[n.school_index].data,"parent"),n.nameChange(n.collegeName,e[n.school_index].data[n.parent_index].children,"college")}catch(e){}}else c.error("加载数据失败","系统维护中...")}).error(function(e){c.error("加载数据失败","系统维护中...")}),n.nameChange=function(a,e,r){try{angular.forEach(e,function(e,t){var o="name";if("school"==r&&(o="schoolName"),e[o]==a)throw n[r+"_index"]=t,""}),n[r+"_index"]=-1}catch(e){}},n.saveData=function(){n.formData.schoolId=null,n.formData.collegeId=null;try{n.formData.schoolId=n.schoolAndCollege[n.school_index].schoolId,n.formData.collegeId=n.schoolAndCollege[n.school_index].data[n.parent_index].id,n.formData.collegeId=n.schoolAndCollege[n.school_index].data[n.parent_index].children[n.college_index].id}catch(e){if(0==t.sign&&n.formData.power<=2&&!n.formData.schoolId||(n.college_index||0===n.college_index)&&!n.formData.collegeId)return void c.error("填写正确的学校信息")}console.log(n.schoolAndCollege,n.school_index);var e={};(e=$.extend(!0,e,n.formData)).birthday=e.birthday.getTime(),i.addRow("userManage/addUserEdu",e).then(function(e){0<e?(c.success("操作成功"),n.close(e)):c.error("操作失败")},function(e){c.error("操作失败","系统维护中")})}}]),app.controller("userEduFormController",["$scope","$rootScope","$uibModalInstance","params","$http","httpService","localStorageService","$interval","SweetAlert",function(o,e,t,a,r,n,i,l,s){o.title=a?"编辑用户教育信息":"新增用户教育信息",o.formData=a||{},o.powerOptions=[{sign:"2",name:"教师"},{sign:"3",name:"学生"}],o.formData.power=""+o.formData.power||"3",o.schoolAndCollege=[],r.get("/collegeManage/getSchoolAndCollege",{params:e.schoolInfo}).success(function(e){"array"==$.type(e)?1==(o.schoolAndCollege=e).length?o.schoolIndex=0:function(e){if(o.formData.sid)for(var t in e)if(o.formData.sid==e[t].id){o.schoolIndex=t,o.formData.collegeId=o.formData.cid;break}}(e):s.error("学校学院加载失败","系统维护中...")}).error(function(e){s.error("学校加载失败","系统维护中...")}),o.close=function(e){t.close(e)},o.dismiss=function(e){t.dismiss(e)},o.saveData=function(){try{o.formData.schoolId=o.schoolAndCollege[o.schoolIndex].id}catch(e){return s.error("操作失败"),void o.close()}n.addRow("userManage/addUserEdu",o.formData).then(function(e){0<e?(s.success("操作成功"),o.close(e)):s.error("操作失败")},function(e){s.error("操作失败","系统维护中")})}}]),app.controller("userListController",["$scope","$rootScope","$state","$uibModal","$http","httpService","localStorageService","SweetAlert",function(a,t,o,r,e,n,i,l){switch(a.sign=t.userInfo.sign,t.menuList=[{title:"用户列表"}],a.bodyTitle=t.menuList[t.menuList.length-1].title,a.pagination={totalCount:0,currentPage:1,totalPage:1,pageSize:0,pageSizeList:[10,20,30]},a.pagination.pageSize=a.pagination.pageSizeList[0],a.powerNameOptions=["数据管理员","校园数据管理员","教师","学生"],a.pageFields={list:[{title:"编号",type:"code",order:"desc",titleStyle:{width:"8em"}},{title:"姓名",type:"name",order:"desc",titleStyle:{width:"8em"},titleClass:"",cellStyle:{},cellClass:"",titleClick:void 0,cellClick:void 0,notNgIf:!1,notNgShow:!1},{title:"电子邮箱",type:"mail",order:"desc",titleStyle:{width:"8em"}},{title:"联系电话",type:"phone",order:"desc",titleStyle:{width:"8em"}},{title:"角色",type:"power",order:"desc",notNgIf:1<t.sign,titleStyle:{width:"9em"}},{title:"学校",type:"schoolName",order:"desc",notNgIf:0<t.sign},{title:"学院",type:"parentName",order:"desc",notNgIf:1<t.sign||0==t.sign},{title:"系",type:"collegeName",order:"desc",notNgIf:1<t.sign||0==t.sign}],order:"power",__order:!1},a.setOrder=function(e){a.pageFields.order==a.pageFields.list[e].type?(a.pageFields.__order=!a.pageFields.__order,a.pageFields.__order?a.pageFields.list[e].order="asc":a.pageFields.list[e].order="desc"):a.pageFields.order=a.pageFields.list[e].type},a.searchOptions={"":{name:"请选择搜索条件"},name:{name:"姓名"},mail:{name:"邮箱"},phone:{name:"电话"}},t.sign){case 0:a.searchOptions.code={name:"编号"},a.searchOptions.type={name:"角色",type:"select"},a.searchOptions.schoolName={name:"学校"};break;case 1:a.searchOptions.code={name:"编号"},a.searchOptions.type={name:"角色",type:"select"},a.searchOptions.collegeName={name:"学院"};break;case 2:a.searchOptions.code={name:"学号"}}function s(e){r.open({backdrop:"static",keyboard:!1,animation:!0,templateUrl:"basicForm.html",controller:"userFormController",resolve:{params:e},size:"lg"}).result.then(function(e){a.queryList()},function(e){})}a.searchValue={key:"",value:""},a.searchInit=function(){a.searchValue.value="",a.queryList()},a.tableData=[],a.queryList=function(){var e={pageSize:a.pagination.pageSize,pageNo:a.pagination.currentPage,order:a.pageFields.order,__order:a.pageFields.__order?0:1};e[a.searchValue.key]=a.searchValue.value;try{e.schoolId=t.schoolInfo.id,e.collegeId=t.schoolInfo.collegeInfo.id}catch(e){}n.getAll("userManage/getAll",e).then(function(e){e?(a.tableData=e.data,a.pagination.pageSize=e.pageSize,a.pagination.currentPage=e.pageNo,a.pagination.totalCount=e.totalCount,a.pagination.totalPage=e.totalPage):l.info("没有用户信息")},function(e){l.error("没有用户信息","请检查网络...")})},a.queryList(),a.addData=function(){s()},a.editData=function(e){s(e)},a.delData=function(e){var o=[];if(e||0==e)o.push(e);else if(a.select_all)for(var t in a.tableData)o.push(a.tableData[t].id);else for(var t in a.tableData)a.tableData[t].checked&&o.push(a.tableData[t].id);0!=o.length?l.swal({title:"确认删除所选择的用户",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"确定",type:"info"},function(e){var t;e&&(t=o,n.delRow("userManage/delRow",{ids:JSON.stringify(t)}).then(function(e){0==e?l.error("删除失败"):(1<e&&l.swal({title:"已删除"+e+"所用户的信息",type:"info",timer:"3000"}),a.queryList())},function(){l.error("删除失败","请检查网络...")}))}):l.info("至少选择一项")},a.editCollegeData=function(e){i.set("userData_collegeSetting",e),o.go("collegeManage",{showAll:2})}}]);