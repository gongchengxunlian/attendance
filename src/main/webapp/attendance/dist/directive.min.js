app.directive("autoTitle",function(){return{restrict:"A",link:function(e,i,n){!function e(){var t=i.text();-1==t.indexOf("{{")?(t=(t=(t=t.replace(/[ \t]{2,}/g," ")).replace(/[ \n]{2,}/g,"\n")).replace(/[ \r\n]{2,}/g,"\r\n"),n.title&&(t=n.title+t),i[0].title=t):setTimeout(function(){e()},500)}()}}}),app.directive("cityLinkage",[function(){"use strict";return{restrict:"E",templateUrl:"views/tpl/cityLinkage.html",replace:!0,scope:{cityList:"="},controller:["$scope","$element","$state",function(e,t,i){e.emitCityValue=function(){e.$emit("cityVlue",{province:e.address.province,city:e.address.city,district:e.address.district})}}],link:function(e,t,i){}}}]),app.directive("uniqueVerify",["$http",function(r){return{restrict:"A",require:"ngModel",scope:{uniqueVerify:"@"},link:function(t,e,i,n){n.$parsers.unshift(function(e){return r({method:"GET",url:t.uniqueVerify,params:{parameter:e}}).success(function(e){var t=!1;-1==e&&(t=!0),n.$setValidity("uniqueVerify",t)}).error(function(e){n.$setValidity("uniqueVerify",!1)}),e})}}}]),app.directive("equals",function(){return{require:"ngModel",link:function(i,e,n,r){function t(e){var t=e===i.$eval(n.equals);return r.$setValidity("equal",t),t?e:void 0}r.$parsers.push(t),r.$formatters.push(t),i.$watch(n.equals,function(){r.$setViewValue(r.$viewValue)})}}}),app.directive("select2",["select2Query",function(o){return{restrict:"A",scope:{config:"=",ngModel:"=",select2Model:"="},link:function(e,t,i){var n=t[0].tagName,r={allowClear:!0,multiple:!!i.multiple,placeholder:i.placeholder||" "};if("SELECT"===n){var c=$(t);return delete r.multiple,angular.extend(r,e.config),c.prepend('<option value=""></option>').val("").select2(r),e.$watch("ngModel",function(e){setTimeout(function(){c.find('[value^="?"]').remove(),c.select2("val",e)},0)},!0),!1}"INPUT"===n&&(c=$(t),i.query&&(e.config=o[i.query]()),e.$watch("config",function(){angular.extend(r,e.config),c.select2("destroy").select2(r)},!0),c.on("change",function(){e.$apply(function(){e.select2Model=c.select2("data")})}),e.$watch("select2Model",function(e){c.select2("data",e)},!0),e.$watch("ngModel",function(e){if(r.ajax||r.multiple)return!1;c.select2("val",e)},!0))}}}]),app.factory("select2Query",["$timeout",function(e){return{testAJAX:function(){return{minimumInputLength:1,ajax:{url:"http://api.rottentomatoes.com/api/public/v1.0/movies.json",dataType:"jsonp",data:function(e){return{q:e,page_limit:10,apikey:"ju6z9mjyajq2djue3gbvv26t"}},results:function(e,t){return{results:e.movies}}},formatResult:function(e){return e.title},formatSelection:function(e){return e.title}}}}}]),app.controller("appCtrl",["$scope","$timeout",function(e,t){e.config1={data:[],placeholder:"尚无数据"},t(function(){e.config1.data=[{id:1,text:"bug"},{id:2,text:"duplicate"},{id:3,text:"invalid"},{id:4,text:"wontfix"}],e.config1.placeholder="加载完毕"},1e3),e.config2=[{id:6,text:"来自ng-repeat"},{id:7,text:"来自ng-repeat"},{id:8,text:"来自ng-repeat"}],e.config3={data:[{id:1,text:"bug"},{id:2,text:"duplicate"},{id:3,text:"invalid"},{id:4,text:"wontfix"}]}}]),angular.module("checkboxSelectAll",[]).directive("selectAllArea",["checkboxFactory","$timeout",function(n,r){return{restrict:"C",link:function(e,t,i){r(function(){var e=n.register();t.attr("checkbox-area",e),t.bind("clearCheckBox",function(){n.clearCheckBox(e)}),t.bind("resetCheckBox",function(){n.resetCheckBox(e)})})}}}]).directive("selectAllCheck",["checkboxFactory","$timeout",function(r,c){return{restrict:"C",scope:!1,require:"?ngModel",link:function(e,t,i,n){c(function(){r.register(t,e,"father",n)})}}}]).directive("selectAllCheckChildren",["checkboxFactory","$timeout",function(r,c){return{restrict:"C",scope:!1,require:"?ngModel",link:function(e,t,i,n){c(function(){r.register(t,e,"children",n)})}}}]).factory("checkboxFactory",function(){var d,f={},e=1,s={timeout:125};function p(e){var t=e.data,i=t.facher,n=t.children;t.scope.$apply(function(){for(var e in i.elem[0].checked=!0,i.ngModel.$setViewValue(!0),n)if(!n[e].elem[0].checked)return i.elem[0].checked=!1,void i.ngModel.$setViewValue(!1)})}function h(e){var t=e.data,i=e.clear,n=t.facher,r=t.children;t.scope.$apply(function(){var e;for(var t in e=i?void 0:n.elem[0].checked,r)r[t].elem[0].checked=e,r[t].ngModel.$setViewValue(e)})}var g={resetCheckBox:function(e){delete f[e].father,delete f[e].children,f[e].father=void 0,f[e].children=[]},clearCheckBox:function(e){h({data:f[e],clear:!0})},registerFather:function(e,t,i,n){f[i].facher={elem:e,ngModel:n},f[i].scope=t},registerChildren:function(e,t,i,n){f[i].children.push({elem:e,ngModel:n})},register:function(n,r,c,o){if(!c||!n||!r)return f[e]={facher:void 0,scope:void 0,children:[]},e++;var a,l=0,u=0;!function t(){var i="select-all-area";(a=$(n).parents("."+i)[0])?function t(){var e=$(a).attr("checkbox-area");e?"father"==c?g.registerFather(n,r,e,o):"children"==c&&(g.registerChildren(n,r,e,o),function e(t){var i=f[t];if(!i.facher)return d&&clearTimeout(d),void(d=setTimeout(function(){e(t)},s.timeout));var n=i.facher,r=i.children;for(var c in n.elem.unbind("change",h),n.elem.bind("change",i,h),r)r[c].elem.unbind("change",p),r[c].elem.bind("change",i,p)}(e)):setTimeout(function(e){16<u++?console.error("register error",n):t()},s.timeout,s)}():setTimeout(function(e){16<l++?console.error("not found class: "+i,a):t()},s.timeout)}()}};return g});